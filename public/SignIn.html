<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="bootstrap-3.3.7-dist/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="./style/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="./style/style.css">
    <script type="text/javascript" src="homepage.js"></script>
</head>

<body>
    <div class="container col-sm-12">
        <div class="row main col-sm-12">
            <div class="logo">
                <img class="logo" src="assets/MyMedicine.png">
            </div>
            <div class="panel-heading">
                <div class="panel-title text-center">
                    <h1 class="title">MyMedicine</h1>
                </div>
            </div>
            <div class="main-login main-center col-sm-12">
                <form class="form-signin" id="signin" action="MainDashborad.html">
                    <h2 class="form-signin-heading">Please sign in</h2>
                    <label for="inputEmail" class="sr-only">Email Address</label>
                    <input name="email" id="Email" class="form-control" placeholder="Email address" required autofocus>
                    <label for="inputPassword" class="sr-only">Password</label>
                    <input name="password" type="password" id="Password" class="form-control" placeholder="Password" required>
                    <button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>
                    <a href="createUser.html">Don't have an account? Sign up.</a>
                </form>
            </div>
        </div>
    </div>
    <script>
        const form = document.getElementById('signin')
        form.addEventListener('submit', login)

        async function login(event) {
            event.preventDefault()
            const email = document.getElementById('Email').value
            const password = document.getElementById('Password').value
            const result = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email,
                    password
                })
            }).then((res) => res.json())

            if (result.status === 'ok') {

                console.log('Got the token: ', result.data)
                localStorage.setItem('token', result.data)
                window.location.href = "./MainDashborad.html"
            } else {
                alert(result.error)
            }
        }
    </script>
</body>

</html>